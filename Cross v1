-- Teleport function: teleport player and NPCs to workspace.Part
local function teleportToPart(npcs)
    local targetPart = workspace:FindFirstChild("Part")
    if not targetPart or not targetPart:IsA("BasePart") then
        warn("workspace.Part not found or is not a BasePart.")
        return
    end

    -- Teleport player
    if hrp and hrp.Parent then
        hrp.CFrame = targetPart.CFrame + Vector3.new(2, 3, 0) -- offset to avoid overlap
    end

    -- Teleport NPCs
    for _, npc in ipairs(npcs) do
        if npc.PrimaryPart and npc.PrimaryPart.Parent then
            npc:SetPrimaryPartCFrame(targetPart.CFrame + Vector3.new(-2, 3, 0))
        end
    end
end

local running = false
local teleportTask

local function startLoop()
    teleportTask = task.spawn(function()
        local npcs = getNPCs()
        freezeJumpLoop(npcs) -- start freeze jump
        while running do
            teleportToPart(npcs)
            task.wait(1.4) -- wait before teleporting again
        end
        unfreezeJumpLoop(npcs)
    end)
end

-- Example toggle
running = state
if running then
    startLoop()
else
    if teleportTask then
        task.cancel(teleportTask)
        teleportTask = nil
    end
    unfreezeJumpLoop(getNPCs())
end
---
