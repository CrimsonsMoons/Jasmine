--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

--// Player & Character
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

--// Checkpoint folder
local checkpointsFolder = workspace.Islands["Training Island"]["Outdoor Arena"]
	.DynamicArena._LAYOUT.CheckpointActivity.Routes["1"]

--// Tween Settings
local tweenInfo = TweenInfo.new(1.2, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)

--// Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "TweenGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- GUI Frame (Top Right or last saved position)
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 60)

-- Load saved position if available
local savedX = gui:GetAttribute("SavedPosX")
local savedY = gui:GetAttribute("SavedPosY")

if savedX and savedY then
	frame.Position = UDim2.new(0, savedX, 0, savedY)
else
	frame.Position = UDim2.new(1, -210, 0.02, 0) -- default top right
end

frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Parent = gui

-- Rounded corners & stroke
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
local stroke = Instance.new("UIStroke", frame)
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Color = Color3.fromRGB(80, 80, 80)
stroke.Thickness = 1.5

-- Tween Button
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, -20, 1, -20)
button.Position = UDim2.new(0, 10, 0, 10)
button.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
button.TextColor3 = Color3.new(1, 1, 1)
button.Text = "Start Tween"
button.Font = Enum.Font.GothamBold
button.TextSize = 18
button.AutoButtonColor = true
button.Parent = frame
Instance.new("UICorner", button).CornerRadius = UDim.new(0, 8)

-- Tween state
local isTweening = false
local currentTween = nil

-- Tween to part
local function tweenTo(part)
	if currentTween then
		currentTween:Cancel()
	end
	local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(part.Position)})
	currentTween = tween
	tween:Play()
	return tween
end

-- Tween through checkpoints
local function tweenSequence()
	isTweening = true
	button.Text = "Stop Tween"

	for i = 1, 6 do
		if not isTweening then break end
		local checkpoint = checkpointsFolder:FindFirstChild(tostring(i))
		if checkpoint and checkpoint:IsA("BasePart") then
			local tween = tweenTo(checkpoint)
			tween.Completed:Wait()
			task.wait(0.1)
		end
	end

	isTweening = false
	button.Text = "Start Tween"
end

-- Button toggle
button.MouseButton1Click:Connect(function()
	if isTweening then
		isTweening = false
		button.Text = "Start Tween"
		if currentTween then currentTween:Cancel() end
	else
		coroutine.wrap(tweenSequence)()
	end
end)

-- Better drag support
local dragging, dragInput, dragStart, startPos

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

frame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - dragStart
		local newPos = startPos + UDim2.new(0, delta.X, 0, delta.Y)
		frame.Position = newPos

		-- Save position to attributes
		gui:SetAttribute("SavedPosX", newPos.X.Offset)
		gui:SetAttribute("SavedPosY", newPos.Y.Offset)
	end
end)
