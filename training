-- Add at the top:
local ContextActionService = game:GetService("ContextActionService")

-- Function to disable controls
local function disableControls()
	ContextActionService:BindAction("DisableMovement", function() return Enum.ContextActionResult.Sink end, false, 
		Enum.PlayerActions.CharacterJump,
		Enum.PlayerActions.MoveForward,
		Enum.PlayerActions.MoveBackward,
		Enum.PlayerActions.MoveLeft,
		Enum.PlayerActions.MoveRight
	)
end

-- Function to re-enable controls
local function enableControls()
	ContextActionService:UnbindAction("DisableMovement")
end

-- Tween to a part
local function tweenTo(part)
	if currentTween then currentTween:Cancel() end
	local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(part.Position)})
	currentTween = tween
	tween:Play()
	return tween
end

-- Tween in order from 1 to 15
local function tweenSequence()
	isTweening = true
	button.Text = "Stop"

	-- Lock character to path
	disableControls()
	hrp.Anchored = true

	for i = 1, 15 do
		local part = routeFolder:FindFirstChild(tostring(i))
		if part and part:IsA("BasePart") and isTweening then
			local tween = tweenTo(part)
			tween.Completed:Wait()
			task.wait(0.1)
		end
	end

	-- Unlock
	isTweening = false
	button.Text = "Start Cross Country"
	hrp.Anchored = false
	enableControls()
end

-- Stop button cancels tween and unlocks player
button.MouseButton1Click:Connect(function()
	if isTweening then
		isTweening = false
		if currentTween then currentTween:Cancel() end
		button.Text = "Start Cross Country"
		hrp.Anchored = false
		enableControls()
	else
		coroutine.wrap(tweenSequence)()
	end
end)
