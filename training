local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local checkpoints = workspace.Islands["Training Island"]["Outdoor Arena"].DynamicArena
    :WaitForChild("_LAYOUT")
    :WaitForChild("CheckpointActivity")
    :WaitForChild("Routes")
    :WaitForChild("Checkpoints")

local checkpointOrder = {"1", "2", "3", "4"}
local teleportDelay = 0.4
local teleporting = false

-- GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TeleportToggleGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 20, 0, 100)
toggleButton.Text = "Start Teleport"
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 170, 255)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20
toggleButton.Parent = screenGui

-- Weld and teleport function
local function teleportAndWeldToCheckpoint(checkpoint)
    -- Remove existing weld
    local existingWeld = humanoidRootPart:FindFirstChild("CheckpointWeld")
    if existingWeld then
        existingWeld:Destroy()
    end

    -- Move character above checkpoint
    humanoidRootPart.CFrame = checkpoint.CFrame * CFrame.new(0, 1, 0)

    -- Weld character to checkpoint
    local weld = Instance.new("WeldConstraint")
    weld.Name = "CheckpointWeld"
    weld.Part0 = humanoidRootPart
    weld.Part1 = checkpoint
    weld.Parent = humanoidRootPart
end

-- Teleport loop
local function startTeleporting()
    teleporting = true
    toggleButton.Text = "Stop Teleport"

    while teleporting do
        for _, checkpointName in ipairs(checkpointOrder) do
            if not teleporting then break end
            local checkpoint = checkpoints:FindFirstChild(checkpointName)
            if checkpoint and checkpoint:IsA("BasePart") then
                teleportAndWeldToCheckpoint(checkpoint)
            end
            task.wait(teleportDelay)
        end
    end

    toggleButton.Text = "Start Teleport"
end

-- Toggle button
toggleButton.MouseButton1Click:Connect(function()
    teleporting = not teleporting
    if teleporting then
        task.spawn(startTeleporting)
    else
        -- Stop teleport loop and remove any existing weld
        local existingWeld = humanoidRootPart:FindFirstChild("CheckpointWeld")
        if existingWeld then
            existingWeld:Destroy()
        end
        toggleButton.Text = "Start Teleport"
    end
end)
