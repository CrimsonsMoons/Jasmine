local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local RunService = game:GetService("RunService")
local islandsFolder = workspace:WaitForChild("Islands")

-- üó∫Ô∏è Display Name ‚Üí Folder Name map
local islandMap = {
    ["Mainland"] = "Mainland",
    ["Forest"] = "Forest Island",
    ["Mountain"] = "Mountain Island",
    ["Lunar"] = "Lunar Islands",
    ["Royal"] = "Royal Island",
    ["Blizzard"] = "Blizzard Island",
    ["Jungle"] = "Jungle Island",
    ["Volcano"] = "Volcano Island",
    ["Desert"] = "Desert Island",
}

-- ‚ùå Exclusions
local excludedBodies = {
    ["{84b93b68-b932-4db8-b765-d1bd9ef8aae9}"] = true,
    ["{c5769905-aecf-4d7a-ada9-064802b0cae9}"] = true,
    ["{d2227f02-c482-4911-b201-7e842b31c47c}"] = true,
    ["{6b019e60-21c6-4536-9a06-4cbfee80d88f}"] = true,
    ["{12916ad6-7fd9-46d5-8bc1-e69671249721}"] = true,
    ["Horse"] = true,
    ["Travel Boat"] = true,
}

-- üì¶ GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "IslandTeleportUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- ü™ü Main container
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 270)
mainFrame.Position = UDim2.new(0, 30, 0, 30)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- üß∑ Title bar (draggable)
local titleBar = Instance.new("TextLabel")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
titleBar.Text = "Island Teleport"
titleBar.Font = Enum.Font.GothamBold
titleBar.TextColor3 = Color3.new(1, 1, 1)
titleBar.TextScaled = true
titleBar.Parent = mainFrame

-- üé£ Drag logic
local dragging, dragInput, dragStart, startPos

titleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

titleBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - dragStart
		mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

-- üìÇ Button container
local buttonFrame = Instance.new("Frame")
buttonFrame.Size = UDim2.new(1, 0, 1, -30)
buttonFrame.Position = UDim2.new(0, 0, 0, 30)
buttonFrame.BackgroundTransparency = 1
buttonFrame.Parent = mainFrame

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0, 5)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Parent = buttonFrame

-- üîÑ State
local currentConnection = nil
local isFollowing = false
local currentIsland = nil

local function stopFollowing()
	if currentConnection then
		currentConnection:Disconnect()
		currentConnection = nil
	end
	isFollowing = false
	currentIsland = nil
end

-- üöÄ NEW: Follow Rocks
local function followIslandRocks(folderName)
	stopFollowing()

	local islandFolder = islandsFolder:FindFirstChild(folderName)
	if not islandFolder then
		warn("Island not found: " .. folderName)
		return
	end

	local rocksList = {}
	for _, item in ipairs(islandFolder:GetChildren()) do
		local rocks = item:FindFirstChild("Rocks")
		if rocks and rocks:IsA("BasePart") and not excludedBodies[item.Name] then
			table.insert(rocksList, rocks)
		end
	end

	if #rocksList == 0 then
		warn("No valid rocks in " .. folderName)
		return
	end

	isFollowing = true
	currentIsland = folderName

	for _, rock in ipairs(rocksList) do
		if not isFollowing then break end

		currentConnection = RunService.RenderStepped:Connect(function()
			if rock and rock.Parent and isFollowing then
				hrp.CFrame = rock.CFrame + Vector3.new(0, 5, 0)
			end
		end)

		while rock and rock.Parent and isFollowing do
			task.wait(0.1)
		end

		if currentConnection then
			currentConnection:Disconnect()
			currentConnection = nil
		end
	end

	stopFollowing()
end

-- üß≠ Buttons
for displayName, folderName in pairs(islandMap) do
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 30)
	btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.Text = displayName
	btn.TextScaled = true
	btn.Parent = buttonFrame

	btn.MouseButton1Click:Connect(function()
		if isFollowing and currentIsland == folderName then
			stopFollowing()
			btn.Text = displayName
		else
			btn.Text = "Following..."
			followIslandRocks(folderName)
			btn.Text = displayName
		end
	end)
end
